// Generated by CoffeeScript 1.3.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  window.RegistrationViewModel = (function() {

    function RegistrationViewModel() {
      this.isAvailableDateToStay = __bind(this.isAvailableDateToStay, this);
      this.start = new Date;
      this.end = new Date;
      this.start.setDate(this.start.getDate() - 7);
      this.end.setDate(this.end.getDate() + 7);
      this.user = {
        name: ko.observable(""),
        surname: ko.observable(""),
        patronymic: ko.observable(""),
        academicDegree: ko.observable(""),
        academicTitle: ko.observable(""),
        jobPosition: ko.observable(""),
        jobPlace: ko.observable(""),
        city: ko.observable(""),
        country: ko.observable("Украина"),
        postalAddress: ko.observable(""),
        email: ko.observable(""),
        phone: ko.observable(""),
        participantType: ko.observable(""),
        lectureTitle: ko.observable(""),
        sectionNumber: ko.observable(""),
        monographyParticipant: ko.observable(false),
        monographyTitle: ko.observable(""),
        stayDemand: ko.observable(false),
        stayStart: ko.observable(""),
        stayEnd: ko.observable("")
      };
      this.files = ko.observableArray();
      this.searchData = window.searchData;
      this.errors = ko.validation.group(this.user);
      this.errorAlert = new Alert("#needFixErrors");
    }

    RegistrationViewModel.prototype.doRegister = function() {
      if (!this.hasValidation) {
        this.addValidation();
      }
      if (this.errors().length === 0) {
        return console.log(ko.mapping.toJS(this.user));
      } else {
        this.errorAlert.show();
        return this.errors.showAllMessages();
      }
    };

    RegistrationViewModel.prototype.formatSize = function(bytes) {
      var GB, KB, MB, _ref;
      _ref = [1024, 1024 * 1024, 1024 * 1024 * 1024], KB = _ref[0], MB = _ref[1], GB = _ref[2];
      if (typeof bytes !== 'number') {
        return "";
      } else if (bytes >= GB) {
        return "" + ((bytes / GB).toFixed(2)) + " GB";
      } else if (bytes >= MB) {
        return "" + ((bytes / MB).toFixed(2)) + " MB";
      } else if (bytes >= KB) {
        return "" + ((bytes / KB).toFixed(2)) + " KB";
      } else {
        return "" + bytes + " B";
      }
    };

    RegistrationViewModel.prototype.isAvailableDateToStay = function(date) {
      console.log(date);
      return true;
    };

    RegistrationViewModel.prototype.addValidation = function() {
      this.makeFieldsRequired();
      return this.hasValidation = true;
    };

    RegistrationViewModel.prototype.makeFieldsRequired = function() {
      var isRequired, key, value, _ref,
        _this = this;
      _ref = this.user;
      for (key in _ref) {
        value = _ref[key];
        if (!(value.extend != null)) {
          continue;
        }
        isRequired = true;
        if (key === "stayStart" || key === "stayEnd") {
          isRequired = {
            onlyIf: this.user.stayDemand
          };
        }
        if (key === "monographyTitle") {
          isRequired = {
            onlyIf: this.user.monographyParticipant
          };
        }
        if (key === "monographyParticipant" || key === "stayDemand") {
          isRequired = false;
        }
        if (value != null) {
          value.extend({
            required: isRequired
          });
        }
      }
      this.user.stayDemand.subscribe(function(value) {
        ko.validation.validateObservable(_this.user.stayStart);
        return ko.validation.validateObservable(_this.user.stayEnd);
      });
      return this.user.monographyParticipant.subscribe(function(value) {
        return ko.validation.validateObservable(_this.user.monographyTitle);
      });
    };

    return RegistrationViewModel;

  })();

}).call(this);
